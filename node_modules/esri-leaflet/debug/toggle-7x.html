<!DOCTYPE html>
  <html>
  <head>
    <meta charset=utf-8 />
    <title>Esri Leaflet Debugging Sample</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet from CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet/0.7.7/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/leaflet/0.7.7/leaflet.js"></script>

    <!-- Load Esri Leaflet from source-->
    <script src="../src/EsriLeaflet.js"></script>
    <script src="../src/Request.js"></script>
    <script src="../src/Util.js"></script>
    <script src="../src/Controls/Logo.js"></script>

    <script src="../src/Services/Service.js"></script>
    <script src="../src/Services/FeatureLayerService.js"></script>
    <script src="../src/Services/ImageService.js"></script>
    <script src="../src/Services/MapService.js"></script>

    <script src="../src/Layers/FeatureLayer/FeatureGrid.js"></script>
    <script src="../src/Layers/FeatureLayer/FeatureManager.js"></script>
    <script src="../src/Layers/FeatureLayer/FeatureLayer.js"></script>

    <script src="../src/Layers/RasterLayer.js"></script>
    <script src="../src/Layers/ImageMapLayer.js"></script>
    <script src="../src/Layers/TiledMapLayer.js"></script>
    <script src="../src/Layers/BasemapLayer.js"></script>
    <script src="../src/Layers/DynamicMapLayer.js"></script>

    <script src="../src/Tasks/Task.js"></script>
    <script src="../src/Tasks/Find.js"></script>
    <script src="../src/Tasks/Identify.js"></script>
    <script src="../src/Tasks/IdentifyFeatures.js"></script>
    <script src="../src/Tasks/IdentifyImage.js"></script>
    <script src="../src/Tasks/Query.js"></script>

    <style>
      body { margin:0; padding:0; }
      #map { position: absolute; top:0; bottom:0; right:0; left:0; }
    </style>
  </head>
  <body>

    <style>
      .label {
        font-weight: 700;
        text-transform: uppercase;
        text-align: center;
        margin-top: -1em;
      }

      .label div {
        position: relative;
        left: -50%;
        text-shadow: 0px 2px 1px rgba(255,255,255,0.85);
      }
    </style>

    <div id="map"></div>

    <script>
      var map = L.map('map').setView([45.526, -122.667], 15);

      var basemap = L.esri.basemapLayer('Gray').addTo(map);

      var neighborhoods = L.esri.featureLayer({
        url: 'https://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/Neighborhoods_pdx/FeatureServer/0',
        style: function() {
          return {
            color: '#5B7CBA',
            weight: 2
          };
        }
      }).addTo(map);

      var baseLayers = {
        Base: basemap
      };
      var overlays = {
        Neighborhoods: neighborhoods
      };

      L.control.layers(baseLayers, overlays).addTo(map);

      var labels = {};

      neighborhoods.on('addfeature', function(e){
        var id = e.feature.id;
        var feature = neighborhoods.getFeature(id);
        var center = feature.getBounds().getCenter();
        var label = L.marker(center, {
          icon: L.divIcon({
            iconSize: null,
            className: 'label',
            html: '<div>' + e.feature.properties.NAME + '</div>'
          })
        }).addTo(map);
        labels[id] = label;
      });

      // neighborhoods.on('addfeature', function(e){
      //   console.log('Adding feature:', e);
      //   var label = labels[e.feature.id];
      //   if(label){
      //     label.addTo(map);
      //   }
      // });

      neighborhoods.on('removefeature', function(e){
        console.log('Removing feature:', e);
        var label = labels[e.feature.id];
        if(label){
          map.removeLayer(label);
        }
      });

    </script>

  </body>
  </html>
